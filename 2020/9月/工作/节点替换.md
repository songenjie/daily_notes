### clickhouse 节点故障问题修复



## 基本条件

1. 所有集群需要有备用机器
2. 集群的所有机器资源初始化 例如 inode 磁盘挂载问题



## 修复/替换流程

1. 故障节点下线
   - 修改集群除故障节点外所有节点配置，去除故障节点 （这里主要原因是用户在用系统表获取所有节点，写入，保障用户写入正常）
   - vip 挂载的故障节点去掉 (这里可以讨论下，是否是必须的，保障 轮训规则，不被轮训规则不会到故障节点)
   - zookeeper 故障节点元数据清理 (这里 1保证副本表同步任务失败一直存在的问题 2 解决新节点上线元数据冲突的问题)
2. 新节点上线
   - 部署程序更新，确定新节点ip替换掉故障节点ip
   - 新节点部署 (鲲鹏)
   - 新节点库表重新创建 （@高明）
3. 集群配置更新
   - 新节点上线 （更新所有节点配置，这里主要指添加新节点的配置）
   - 更新相关文档 （CF相关文档）
   - vip 添加新的节点 （轮训规则）



